// Generated by CoffeeScript 1.8.0

/* 
Validator v0.0.1
Licensed under MIT
 */

(function() {
  'use strict';
  var Validator, old;

  Validator = (function() {
    function Validator(element) {
      this.$element = $(element);
    }

    return Validator;

  })();

  Validator.prototype.result = {};

  Validator.prototype.settings = {
    MAXLENGTH: {},
    MINLENGTH: {},
    ATMOST: {},
    ATLEAST: {},
    REPEAT: {}
  };

  Validator.prototype.validate = function(config, callback) {
    var $input, ATLEAST_PATTERN, ATMOST_PATTERN, MAXLENGTH_PATTERN, MINLENGTH_PATTERN, PATTERNS, identifier, key, result, type, types, value, _i, _len, _ref;
    MAXLENGTH_PATTERN = /maxLength=/i;
    MINLENGTH_PATTERN = /minLength=/i;
    ATMOST_PATTERN = /atMost=/i;
    ATLEAST_PATTERN = /atLeast=/i;
    PATTERNS = [MAXLENGTH_PATTERN, MINLENGTH_PATTERN, ATMOST_PATTERN, ATLEAST_PATTERN];
    for (key in config) {
      value = config[key];
      if (!(config.hasOwnProperty(key) && key !== 'msg')) {
        continue;
      }
      types = value;
      identifier = "input[name=" + key + "]";
      $input = this.$element.find($(identifier));
      for (_i = 0, _len = types.length; _i < _len; _i++) {
        type = types[_i];
        result = this[type](key, (_ref = $input.val()) != null ? _ref.trim() : void 0);
        if (!result.pass) {
          return callback({
            pass: false,
            msg: config.msg[key][type]
          });
        }
      }
    }
    return callback({
      pass: true
    }, this.result);
  };

  Validator.prototype.notEmpty = function(name, value) {
    var regex, result;
    regex = /^\s+$/;
    result = value.length && regex.test(value);
    if (result) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  Validator.prototype.email = function(name, value) {
    var regex, result;
    regex = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    result = regex.test(value);
    if (result) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  Validator.prototype.phone = function(name, value) {
    var regex, result;
    regex = /^1[3-9]\d{9}$/;
    result = regex.test(value);
    if (result) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  Validator.prototype.minLength = function(name, value) {
    var len, minLen;
    len = value.length;
    minLen = parseInt(this.settings.MINLENGTH[name], 10);
    if (len >= minLen) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  Validator.prototype.maxLength = function(name, value) {
    var len, maxLen;
    len = value.length;
    maxLen = parseInt(this.settings.MAXLENGTH[name], 10);
    if (len <= maxLen) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  Validator.prototype.atLeast = function(name, value) {
    var len, minLen;
    len = $("input[name=" + name + "]:checked").length;
    minLen = this.settings.ATLEAST[name];
    if (len >= minLen) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  Validator.prototype.atMost = function(name, value) {
    var len, maxLen;
    len = $("input[name=" + name + "]:checked").length;
    maxLen = this.settings.ATMOST[name];
    if (len <= maxLen) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  Validator.prototype.int = function(name, value) {
    var result;
    result = !isNaN(value);
    if (result) {
      this.result[name] = value;
      return {
        pass: true
      };
    }
    return {
      pass: false
    };
  };

  old = $.fn.validate;

  $.fn.validate = function(config, callback) {
    return new Validator(this).validate(config, callback);
  };

  $.fn.validate.noConflict = function() {
    $.fn.validate = old;
    return this;
  };

}).call(this);
